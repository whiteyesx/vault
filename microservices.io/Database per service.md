

## Context and problem

* Сервисы должны быть слабосвязны так, чтобы они могли разрабатываться, масштабироваться и поставляться независимо.
* Некоторые бизнес транзакции затрагивают обновление сразу нескольких сервисов
* Некоторые бизнес транзакции производят чтение сразу с нескольких сервисов
* Базы данных должны поддерживать независимую репликацию и шардинг.
* Разные сервисы имеют разные требования к хранилищу данных.

## Solution

Построить индивидуальное хранилище данных для каждого микросервиса и сделать его доступным только через внешний API. Транзакции сервиса должны затрагивать только его базу данных. База данных должна стать частью реализации конкретного сервиса.

Существует несколько способов для разграничения доступа к данным конкретного сервиса:

* Каждый сервис может иметь выделенные для него таблицы
* Каждый сервис может иметь выделенную схему
* Каждый сервис может иметь отдельную базу данных

## Resulting Context

**Плюсы:**
* Каждый сервис изолирован 
* Каждый сервис имеет выделенную базу данных под его нужды
**Минусы:**
* Реализация транзакций, которые затрагивают несколько сервисов непроста. Распределенных транзакций стоит избегать
* Реализация запросов соединяющих данных может быть сложна.
* Сложность поддержания SQL и NOSQL баз данных одновременно

Несколько паттернов, позволяющих реализовывать транзакции и запросы затрагивающие несколько сервисов:
* API Composition - приложение выполняет соединение данных. Например сервис  (или API Gateway) который обращается в UserService для получения данных пользователя, а потом в OrderService для получения его самых частых заказов.
* CQRS - поддерживать материализованное представление, которое содержит данные с нескольких сервисов. Представления поддерживаются сервисами которые подписаны на ивенты, который каждый сервис публикует при обновлении данных. Например онлайн магазин может реализовать запрос который находит пользователей в указанном регионе и их последние заказы путем поддержание представления, которое соединяет users и orders. Представление обновляется сервисом, который подписан на user и order events.
